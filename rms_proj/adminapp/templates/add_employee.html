{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Add Employee</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      background-color: #ffffff;
      color: #000000;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .background-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.10;
      z-index: 0;
      max-width: 400px;
      width: 80%;
      pointer-events: none;
    }

    .form-card {
      position: relative;
      z-index: 1;
      background-color: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: #000000;
      padding: 30px;
      border-radius: 16px;
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.05),
        0 4px 12px rgba(0, 0, 0, 0.1),
        0 -4px 12px rgba(0, 0, 0, 0.06),
        -4px 0 12px rgba(0, 0, 0, 0.08),
        4px 0 12px rgba(0, 0, 0, 0.08);
      width: 100%;
      max-width: 800px;
    }

    .form-card h3 {
      text-align: center;
      margin-bottom: 25px;
      font-weight: bold;
      color: #007bff;
      text-transform: uppercase;
    }

    .form-label {
      font-weight: 600;
      color: #131414ff;
    }

    .form-control,
    .form-select {
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.2);
      background-color: rgba(255, 255, 255, 0.6);
      color: #000000;
    }

    .form-control::placeholder {
      color: #666;
    }

    .btn-submit {
      background-color: #28a745;
      color: #ffffff;
      font-weight: 600;
      width: 50%;
      border: none;
      border-radius: 8px;
      padding: 12px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      text-align: center;
      display: inline-block;
      margin-left: 190px;
    }

    .btn-submit:hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px rgba(40, 167, 69, 0.4);
    }

    @media (max-width: 768px) {
      .row .col-md-6 {
        margin-bottom: 15px;
      }
      .btn-submit {
        margin-left: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="form-card">
    <h3>Add New Employee</h3>
    <form method="POST" action="{% url 'add_employee' %}" onsubmit="return validateForm()">
      <img src="{% static 'rms_app/images/agt_img.png' %}" alt="Background Logo" class="background-logo" />
      {% csrf_token %}
      {% if messages %}
        <div class="alert alert-warning">
          {% for message in messages %}
            <div>{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="username" class="form-label">Full Name</label>
          <input type="text" name="username" id="username" class="form-control" required />
        </div>
        <div class="col-md-6 mb-3">
          <label for="email" class="form-label">Email Address</label>
          <input type="email" name="email" id="email" class="form-control" required oninput="this.value = this.value.toLowerCase();" />
        </div>
        <div class="col-md-6 mb-3">
          <label for="password" class="form-label">Password</label>
          <input type="password" name="password" id="password" class="form-control" required />
        </div>
        <div class="col-md-6 mb-3">
          <label for="emp_id" class="form-label">Employee ID</label>
          <input type="text" name="emp_id" id="emp_id" class="form-control" required />
        </div>
        <div class="col-md-6 mb-3">
          <label for="designation" class="form-label">Designation</label>
          <input type="text" name="designation" id="designation" class="form-control" required />
        </div>
        <div class="col-md-6 mb-3">
          <label for="pan" class="form-label">PAN Number</label>
          <input type="text" name="pan" id="pan" class="form-control" required oninput="this.value = this.value.toUpperCase();" />
        </div>
        <div class="col-md-6 mb-3">
          <label for="role" class="form-label">Role</label>
          <select name="role" id="role" class="form-select" required>
            <option value="" disabled selected>Select Role</option>
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label for="salary_lpa" class="form-label">Salary (LPA)</label>
          <input type="number" step="0.01" name="salary_lpa" id="salary_lpa" class="form-control" required />
        </div>
      </div>
      <button type="submit" class="btn btn-submit mt-3">Add Employee</button>

      <div class="text-center mt-3">
        {% if request.user.is_superuser %}
          <a href="{% url 'home' %}" class="btn btn-light">Back to Dashboard</a>
        {% elif request.user.profile.role == 'admin' %}
          <a href="{% url 'admin_dashboard' %}" class="btn btn-light">Back to Dashboard</a>
        {% else %}
          <a href="{% url 'home' %}" class="btn btn-light">Back to Dashboard</a>
        {% endif %}
      </div>
    </form>
  </div>

  <script>
  async function checkEmpIdExists(empId) {
    try {
      const response = await fetch(`/check_emp_id/?emp_id=${encodeURIComponent(empId)}`);
      const data = await response.json();
      return data.exists;
    } catch (error) {
      console.error("Error checking Employee ID:", error);
      return false;
    }
  }

  async function validateForm() {
    const name = document.getElementById("username").value.trim();
    const panField = document.getElementById("pan");
    const pan = panField.value.trim().toUpperCase();
    panField.value = pan;

    const emailField = document.getElementById("email");
    const email = emailField.value.trim().toLowerCase();
    emailField.value = email;

    const empIdField = document.getElementById("emp_id");
    const empId = empIdField.value.trim();
    empIdField.value = empId;

    if (!/^[A-Za-z\s]+$/.test(name)) {
      alert("Full Name must contain only alphabets and spaces.");
      return false;
    }

    if (!/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(pan)) {
      alert("PAN must be 10 characters: 5 uppercase letters, 4 digits, and 1 uppercase letter.");
      return false;
    }

    const emailExists = await checkEmailExists(email);
    if (emailExists) {
      alert("This email is already registered. Please use a different one.");
      return false;
    }

    const panExists = await checkPanExists(pan);
    if (panExists) {
      alert("This PAN is already registered. Please use a different one.");
      return false;
    }

    const empIdExists = await checkEmpIdExists(empId);
    if (empIdExists) {
      alert("This Employee ID is already registered. Please use a different one.");
      return false;
    }

    return true;
  }
</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
